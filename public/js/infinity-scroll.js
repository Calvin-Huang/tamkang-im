// Generated by CoffeeScript 1.6.3
(function() {
  var ajaxLock, appendNews, currentPage, getLoaderPosition, loaderPosition, noDataFlag, positionToTop, totalHeight;

  ajaxLock = false;

  noDataFlag = false;

  getLoaderPosition = function() {
    return $('#infinity-loader').offset().top - $(window).height() + $('infinity-loader').height();
  };

  appendNews = function(page) {
    ajaxLock = true;
    return $.ajax({
      url: '',
      data: {
        'page': page
      },
      type: 'POST',
      dataType: 'html',
      success: function(data, textStatus, jqXHR) {
        if (data === '') {
          $('#infinity-loader').fadeOut(200);
          return noDataFlag = true;
        } else {
          return $(data).insertBefore('#infinity-loader').fadeIn(1000, function() {
            ajaxLock = false;
            return currentPage++;
          });
        }
      },
      error: function(jqXHR, textStatus, errorThrown) {}
    });
  };

  totalHeight = $('html, body').height() - $(window).height();

  positionToTop = 0;

  loaderPosition = getLoaderPosition();

  currentPage = 1;

  $(window).scroll(function() {
    positionToTop = $(this).scrollTop();
    if (!ajaxLock && !noDataFlag) {
      loaderPosition = getLoaderPosition();
      if (positionToTop >= loaderPosition) {
        return appendNews(currentPage + 1);
      }
    }
  });

}).call(this);
